var __extends=this&&this.__extends||function(a,b){function d(){this.constructor=a}for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);a.prototype=null===b?Object.create(b):(d.prototype=b.prototype,new d)};define("annotations/util",["require","exports"],function(a,b){"use strict";var c;!function(a){function e(a,b,c){return{r:a,g:b,b:c}}function f(a,b,c){return{h:a,s:b,l:c}}function g(a,b){return{r:(a.r+b.r)/2,g:(a.g+b.g)/2,b:(a.b+b.b)/2}}function h(a,b){return[0,0,0,b,a,b/2]}function i(a,b){return[a,0,a,b,0,b/2]}function j(a){for(var b=a.length;b>0;){var c=Math.floor(Math.random()*b);b--;var d=a[b];a[b]=a[c],a[c]=d}return a}function k(){return{r:Math.random(),g:Math.random(),b:Math.random()}}function l(a,b){var c=b||.5;return c=1-c,{h:a.h,s:a.s,l:a.l*c}}function m(a,b){return{h:a.h*b.h,s:a.s*b.s,l:a.l*b.l}}function n(a){if(a<180){for(var b=[],c=360*Math.random(),d=360/a,g=0;g<a;g++){var h=c+d*g,i=h+d/2+(2*Math.random()-1)*(d/8);i>=360&&(i-=360);var k=.5*Math.random()+.5,l=.85;b.push(f(i,k,l))}return j(b)}for(var b=[],n=(e(1,1,1),0);n<a;n++)b.push({h:360*Math.random(),s:.5*Math.random()+.5,l:.125*Math.random()+.75});return b}function o(a){var f,g,h,b=a.h/360,c=a.s,d=a.l;if(0===c)f=g=h=d;else{var i=function(b,c,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?b+6*(c-b)*d:d<.5?c:d<2/3?b+(c-b)*(2/3-d)*6:b},j=d<.5?d*(1+c):d+c-d*c,k=2*d-j;f=i(k,j,b+1/3),g=i(k,j,b),h=i(k,j,b-1/3)}return e(f,g,h)}function p(a){var b=a.r,c=a.g,d=a.b,e=Math.max(b,Math.max(c,d)),f=Math.min(b,Math.min(c,d)),g=e-f,h=1e-7,i=0,j=(e+f)/2,k=0;return g>=-h&&g<h?i=0:e===b?(i=(c-d)/g%6*60,k=g/(1-Math.floor(2*j-1))):e===c?(i=60*((d-b)/g+2),k=g/(1-Math.floor(2*j-1))):e===d&&(i=60*((b-c)/g+4),k=g/(1-Math.floor(2*j-1))),{h:i,s:k,l:j}}function q(a){var b,c,d;if(3===a.length)b=a[0]+a[0],c=a[1]+a[1],c=a[2]+a[2];else if(6!==a.length)throw new Error("Invalid hex passed to hex2rgb!");var e=parseInt(b,16)/255,f=parseInt(c,16)/255,g=parseInt(d,16)/255;return{r:e,g:f,b:g}}function r(a){var b=Math.round(255*a.r).toString(16),c=Math.round(255*a.g).toString(16),d=Math.round(255*a.b).toString(16);return"#"+(b.length>1?b:"0"+b)+(c.length>1?c:"0"+c)+(d.length>1?d:"0"+d)}function s(a,b,c,d,e){return"M"+a+" "+(d+e)+"C"+a+" "+d+","+b+" "+(d+e)+","+b+" "+d+"C"+b+" "+(d+e)+","+c+" "+d+","+c+" "+(d+e)}function t(a,b){for(var c,d=0,e=b.length-1;e-d>1;)c=Math.floor((d+e)/2),b[c]<a?d=c:e=c;return a-b[d]<=b[e]-a?d:e}var b=function(){function a(a,b,c,d){this.id=a,this.value=d,this.minX=b,this.maxX=c}return a}();a.SpatialItem=b;var c=function(){function a(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.items=[]}return a.prototype.add=function(a){this.minX=Math.min(a.minX,this.minX),this.maxX=Math.max(a.maxX,this.maxX),this.items.push(a)},a}(),d=function(){function a(a,b,c){this.buckets={},this.idCnt=0,this.minX=a,this.maxX=b,this.range=b-a,this.numBuckets=c}return a.prototype.add=function(a,d,e){for(var f=Math.floor((a-this.minX)/this.range*this.numBuckets),g=Math.floor((d-this.minX)/this.range*this.numBuckets),h=Math.min(this.numBuckets-1,Math.max(0,f)),i=Math.min(this.numBuckets-1,Math.max(0,g))+1,j=h;j<i;j++){var k=this.buckets[j];void 0===k&&(k=new c,this.buckets[j]=k),k.add(new b(this.idCnt,a,d,e)),this.idCnt+=1}},a.prototype.anyIntersection=function(a,b){for(var c=Math.floor((a-this.minX)/this.range*this.numBuckets),d=Math.floor((b-this.minX)/this.range*this.numBuckets),e=Math.min(this.numBuckets-1,Math.max(0,c)),f=Math.min(this.numBuckets-1,Math.max(0,d))+1,i=e;i<f;i++){var j=this.buckets[i];if(void 0!==j&&a<j.maxX&&b>j.minX)for(var k=0,l=j.items;k<l.length;k++){var m=l[k];if(a<m.maxX&&b>m.minX)return!0}}return!1},a.prototype.intersections=function(a,b){for(var c=Math.floor((a-this.minX)/this.range*this.numBuckets),e=(Math.floor((b-this.minX)/this.range*this.numBuckets),Math.min(this.numBuckets-1,Math.max(0,c))),f=Math.min(this.numBuckets-1,Math.max(0,c))+1,g={},h=[],i=e;i<f;i++){var j=this.buckets[i];if(void 0!==j&&a<j.maxX&&b>j.minX)for(var k=0,l=j.items;k<l.length;k++){var m=l[k];void 0!==g[m.id]&&a<m.maxX&&b>m.minX&&(h.push(m),g[m.id]=!0)}}return h},a}();a.SparseGridSpatialIndex=d,a.rgb=e,a.hsl=f,a.mixRgb=g,a.rightTriangle=h,a.leftTriangle=i,a.shuffle=j,a.randomRgb=k,a.darkerHsl=l,a.mulHsl=m,a.generatePastelColors=n,a.hsl2rgb=o,a.rgb2hsl=p,a.hex2rgb=q,a.rgb2hex=r,a.curlyPath=s,a.closestIndex=t}(c||(c={})),b.Util=c}),define("annotations/componentmodel",["require","exports","annotations/util"],function(a,b,c){"use strict";!function(a){a[a.LEFT_TOP=0]="LEFT_TOP",a[a.LEFT_CENTER=1]="LEFT_CENTER",a[a.LEFT_BOTTOM=2]="LEFT_BOTTOM",a[a.RIGHT_TOP=3]="RIGHT_TOP",a[a.RIGHT_CENTER=4]="RIGHT_CENTER",a[a.RIGHT_BOTTOM=5]="RIGHT_BOTTOM",a[a.TOP_LEFT=6]="TOP_LEFT",a[a.TOP_CENTER=7]="TOP_CENTER",a[a.TOP_RIGHT=8]="TOP_RIGHT",a[a.BOTTOM_LEFT=9]="BOTTOM_LEFT",a[a.BOTTOM_CENTER=10]="BOTTOM_CENTER",a[a.BOTTOM_RIGHT=11]="BOTTOM_RIGHT",a[a.CENTER=12]="CENTER"}(b.AnchorPoint||(b.AnchorPoint={}));var d=b.AnchorPoint,e=function(){function a(a,b,c,d){this.x=a||0,this.y=b||0,this.w=c||0,this.h=d||0}return a.prototype.minX=function(){return this.x},a.prototype.maxX=function(){return this.x+this.w},a.prototype.minY=function(){return this.y},a.prototype.maxY=function(){return this.y+this.h},a.prototype.anchor=function(a){switch(a){case d.TOP_LEFT:case d.LEFT_TOP:return{x:this.x,y:this.y};case d.LEFT_CENTER:return{x:this.x,y:this.y+this.h/2};case d.BOTTOM_LEFT:case d.LEFT_BOTTOM:return{x:this.x,y:this.y+this.h};case d.TOP_CENTER:return{x:this.x+this.w/2,y:this.y};case d.TOP_RIGHT:case d.RIGHT_TOP:return{x:this.x+this.w,y:this.y};case d.RIGHT_CENTER:return{x:this.x+this.w,y:this.y+this.h/2};case d.RIGHT_BOTTOM:case d.BOTTOM_RIGHT:return{x:this.x+this.w,y:this.y+this.h};case d.CENTER:return{x:this.x+this.w/2,y:this.y+this.h/2};case d.BOTTOM_CENTER:return{x:this.x+this.w/2,y:this.y+this.h}}},a.prototype.translate=function(b,c){var d=new a;return d.x=this.x+b,d.y=this.y+c,d.w=this.w,d.h=this.h,d},a}();b.BBox=e,function(a){a[a.EDGE_BACKGROUND=0]="EDGE_BACKGROUND",a[a.BACKGROUND=1]="BACKGROUND",a[a.HIGHLIGHT_BACKGROUND=2]="HIGHLIGHT_BACKGROUND",a[a.TEXT=3]="TEXT",a[a.LABEL=4]="LABEL"}(b.RenderLayer||(b.RenderLayer={}));var g,f=b.RenderLayer;!function(a){function b(b,c,d){for(var f={},g={},h=0;h<c.length;h++){var i=c[h],j=d[h];void 0===f[j]&&(f[j]={},g[j]={}),void 0===f[j][i]&&(f[j][i]=new e)}for(var k=document.createElementNS(a.NS,"g"),l=0,m=Object.keys(f);l<m.length;l++)for(var n=m[l],o=0,p=Object.keys(f[n]);o<p.length;o++){var q=p[o],r=document.createElementNS(a.NS,"text");r.setAttribute("x","0.0"),r.setAttribute("y","0.0"),r.setAttribute("class",n),r.appendChild(document.createTextNode(q)),k.appendChild(r),g[n][q]=r}b.appendChild(k);for(var s=0,t=Object.keys(f);s<t.length;s++)for(var n=t[s],u=0,v=Object.keys(f[n]);u<v.length;u++){var w=v[u],x=g[n][w].getBBox(),y=f[n][w];y.x=x.x,y.y=x.y,y.w=x.width,y.h=x.height}return b.removeChild(k),f}a.NS="http://www.w3.org/2000/svg",a.measureTexts=b}(g=b.Svg||(b.Svg={}));var h=[f.EDGE_BACKGROUND,f.BACKGROUND,f.HIGHLIGHT_BACKGROUND,f.TEXT,f.LABEL],i=["annotation-layer-edge-background","annotation-layer-background","annotation-layer-highlight","annotation-layer-text","annotation-layer-label"],j=function(){function a(a){this.layers={},this.stack=[],this.fill="",this.stroke="",this.styleClass="",this.data={},this.layerClasses={},this.translateX=0,this.translateY=0,this.translationStack=[],this.renderElem=a;for(var b=0;b<h.length;b++){var c=h[b],d=i[b];this.layers[c]=document.createElementNS(g.NS,"g"),this.layers[c].setAttribute("class",d)}}return a.prototype.write=function(){for(var a=0,b=h;a<b.length;a++){var c=b[a];this.renderElem.appendChild(this.layers[c])}},a.prototype.clearStyle=function(){this.stroke="",this.fill="",this.styleClass=""},a.prototype.pushTranslation=function(a,b){this.translationStack.push(this.translateX),this.translationStack.push(this.translateY),this.translateX+=a,this.translateY+=b},a.prototype.popTranslation=function(){this.translateY=this.translationStack.pop(),this.translateX=this.translationStack.pop()},a.prototype.push=function(a,b,c){a=a||0,b=b||0,a+=this.translateX,b+=this.translateY,this.translationStack.push(this.translateX),this.translationStack.push(this.translateY),this.translateX=0,this.translateY=0,this.stack.push(this.layers),this.layers={};for(var d=0;d<h.length;d++){var e=h[d],f=i[d],j=document.createElementNS(g.NS,"g");void 0!==this.layerClasses[e]?j.setAttribute("class",f+" "+this.layerClasses[e]):j.setAttribute("class",f),void 0!==c&&j.setAttribute("id",c),0===a&&0===b||j.setAttribute("transform","translate("+a.toString(10)+", "+b.toString(10)+")"),this.layers[e]=j}this.layerClasses={}},a.prototype.addText=function(a,b,c,d){var e=document.createElementNS(g.NS,"text");""!==this.styleClass&&e.setAttribute("class",this.styleClass),e.setAttribute("x",(c+this.translateX).toString(10)),e.setAttribute("y",(d+this.translateY).toString(10));for(var f=0,h=Object.keys(this.data);f<h.length;f++){var i=h[f];e.setAttribute("data-"+i,this.data[i])}this.data={},e.appendChild(document.createTextNode(b)),this.layers[a].appendChild(e)},a.prototype.addTextSpanLine=function(a,b,c,d){var e=document.createElementNS(g.NS,"text");""!==this.styleClass&&e.setAttribute("class",this.styleClass),e.setAttribute("x","0"),e.setAttribute("y","0");for(var f=0,h=Object.keys(this.data);f<h.length;f++){var i=h[f];e.setAttribute("data-"+i,this.data[i])}this.data={};for(var j=0;j<b.length;j++){var k=document.createElementNS(g.NS,"tspan");k.setAttribute("x",(c[j]+this.translateX).toString(10)),k.setAttribute("y",(d[j]+this.translateY).toString(10)),k.appendChild(document.createTextNode(b[j])),e.appendChild(k)}this.layers[a].appendChild(e)},a.prototype.addRect=function(a,b,c,d,e,f,h){var i=document.createElementNS(g.NS,"rect");""!==this.styleClass&&i.setAttribute("class",this.styleClass),i.setAttribute("x",(b+this.translateX).toString(10)),i.setAttribute("y",(c+this.translateY).toString(10)),i.setAttribute("width",d.toString(10)),i.setAttribute("height",e.toString(10));for(var j=0,k=Object.keys(this.data);j<k.length;j++){var l=k[j];i.setAttribute("data-"+l,this.data[l])}this.data={},0===f&&0===h||(i.setAttribute("rx",f.toString(10)),i.setAttribute("ry",h.toString(10))),""!==this.stroke&&i.setAttribute("stroke",this.stroke),""!==this.fill&&i.setAttribute("fill",this.fill),this.layers[a].appendChild(i)},a.prototype.addEdgeLine=function(a,b,c,d,e,f,h,i){b+=this.translateX,d+=this.translateX,f+=this.translateX,c+=this.translateY,e+=this.translateY,h+=this.translateY;var j="M "+b+","+c;j+=Math.abs(d-f)<1e-5&&Math.abs(e-h)<1e-5?" L "+f+","+h:" Q "+d+","+e+" "+f+","+h;var k=document.createElementNS(g.NS,"path");k.setAttribute("d",j),""!==this.styleClass&&k.setAttribute("class",this.styleClass),"end"===(i||"")&&k.setAttribute("marker-end","url(#arrow)"),""!==this.stroke&&k.setAttribute("stroke",this.stroke),""!==this.fill&&k.setAttribute("fill",this.fill),this.layers[a].appendChild(k)},a.prototype.addCurly=function(a,b,d,e,f,h){b+=this.translateX,d+=this.translateX,e+=this.translateX,f+=this.translateY;var i=c.Util.curlyPath(b,d,e,f,h),j=document.createElementNS(g.NS,"path");j.setAttribute("d",i),""!==this.styleClass&&j.setAttribute("class",this.styleClass),""!==this.stroke&&j.setAttribute("stroke",this.stroke),""!==this.fill&&j.setAttribute("fill",this.fill),this.layers[a].appendChild(j)},a.prototype.addLine=function(a,b,c,d,e,f){var h=document.createElementNS(g.NS,"line");h.setAttribute("x1",(b+this.translateX).toString(10)),h.setAttribute("y1",(c+this.translateY).toString(10)),h.setAttribute("x2",(d+this.translateX).toString(10)),h.setAttribute("y2",(e+this.translateY).toString(10)),void 0!==f&&h.setAttribute("stroke-width",f.toString(10)),""!==this.stroke&&h.setAttribute("stroke",this.stroke),""!==this.styleClass&&h.setAttribute("class",this.styleClass),this.layers[a].appendChild(h)},a.prototype.addPolygon=function(a,b,c,d){b+=this.translateX,c+=this.translateY;for(var e=document.createElementNS(g.NS,"polygon"),f=[],h=0;h<d.length;h+=2)f.push((d[h]+b).toString()+","+(d[h+1]+c).toString());e.setAttribute("points",f.join(" ")),""!==this.styleClass&&e.setAttribute("class",this.styleClass),""!==this.stroke&&e.setAttribute("stroke",this.stroke),""!==this.fill&&e.setAttribute("fill",this.fill),this.layers[a].appendChild(e)},a.prototype.pop=function(){for(var a=this.stack.pop(),b=0,c=h;b<c.length;b++){var d=c[b];this.layers[d].hasChildNodes&&a[d].appendChild(this.layers[d])}this.layers=a,this.popTranslation()},a}();b.AnnoGraphics=j;var k=function(){function a(){this.renderLayer=f.TEXT,this.x=0,this.y=0,this.data={}}return a.prototype.translate=function(a,b){return this.x=this.x+a,this.y=this.y+b,this},a.prototype.attach=function(a,b){switch(b){case d.TOP_LEFT:case d.LEFT_TOP:this.x=a.x,this.y=a.y;break;case d.LEFT_CENTER:this.x=a.x,this.y=a.y-this.height()/2;break;case d.BOTTOM_LEFT:case d.LEFT_BOTTOM:this.x=a.x,this.y=a.y-this.height();break;case d.TOP_CENTER:this.x=a.x-this.width()/2,this.y=a.y;break;case d.TOP_RIGHT:case d.RIGHT_TOP:this.x=a.x-this.width(),this.y=a.y;break;case d.RIGHT_CENTER:this.x=a.x-this.width(),this.y=a.y-this.height()/2;break;case d.RIGHT_BOTTOM:case d.BOTTOM_RIGHT:this.x=a.x-this.width(),this.y=a.y-this.height();break;case d.CENTER:this.x=a.x-this.width()/2,this.y=a.y-this.height()/2;break;case d.BOTTOM_CENTER:this.x=a.x-this.width()/2,this.y=a.y-this.height()}return this},a.prototype.anchor=function(a){switch(a){case d.TOP_LEFT:case d.LEFT_TOP:return{x:this.x,y:this.y};case d.LEFT_CENTER:return{x:this.x,y:this.y+this.height()/2};case d.BOTTOM_LEFT:case d.LEFT_BOTTOM:return{x:this.x,y:this.y+this.height()};case d.TOP_CENTER:return{x:this.x+this.width()/2,y:this.y};case d.TOP_RIGHT:case d.RIGHT_TOP:return{x:this.x+this.width(),y:this.y};case d.RIGHT_CENTER:return{x:this.x+this.width(),y:this.y+this.height()/2};case d.RIGHT_BOTTOM:case d.BOTTOM_RIGHT:return{x:this.x+this.width(),y:this.y+this.height()};case d.CENTER:return{x:this.x+this.width()/2,y:this.y+this.height()/2};case d.BOTTOM_CENTER:return{x:this.x+this.width()/2,y:this.y+this.height()}}},a}();b.AnnoElement=k;var l=function(a){function b(b,c,d,f,g){a.call(this),this.x=b||0,this.y=c||0,this.text=d||"",this.textMeas=f||new e,this.textClass=g||"annotation-text"}return __extends(b,a),b.prototype.width=function(){return this.textMeas.w},b.prototype.height=function(){return this.textMeas.h},b.prototype.render=function(a){a.data=this.data,a.styleClass=this.textClass,a.addText(this.renderLayer,this.text,this.x,this.y-this.textMeas.y),a.clearStyle()},b}(k);b.AnnoTextElement=l;var m=function(a){function b(b,c,d,e){a.call(this),this.x2=0,this.y2=0,this.strokeWidth=1,this.stroke="",this.styleClass="",this.x=b||0,this.y=c||0,this.x2=d||0,this.y2=e||0}return __extends(b,a),b.prototype.height=function(){return Math.abs(this.y2)},b.prototype.width=function(){return Math.abs(this.x2)},b.prototype.render=function(a){a.data=this.data,a.styleClass=this.styleClass,a.stroke=this.stroke,a.addLine(this.renderLayer,this.x,this.y,this.x2+this.x,this.y2+this.y,this.strokeWidth),a.clearStyle()},b}(k);b.AnnoLineElement=m;var n=function(a){function b(b,c,d,e,f,g){a.call(this),this.dxMiddle=0,this.dyMiddle=0,this.dxEnd=0,this.dyEnd=0,this.strokeWidth=1,this.stroke="",this.styleClass="",this.arrow="",this.x=b||0,this.y=c||0,this.dxMiddle=(d||0)-this.x,this.dyMiddle=(e||0)-this.y,this.dxEnd=(f||0)-this.x,this.dyEnd=(g||0)-this.y}return __extends(b,a),b.prototype.height=function(){return Math.abs(this.dyEnd)},b.prototype.width=function(){return Math.abs(this.dxEnd)},b.prototype.render=function(a){a.data=this.data,a.styleClass=this.styleClass,a.stroke=this.stroke,a.addEdgeLine(this.renderLayer,this.x,this.y,this.dxMiddle+this.x,this.dyMiddle+this.y,this.dxEnd+this.x,this.dyEnd+this.y,this.arrow),a.clearStyle()},b}(k);b.AnnoEdgeLineElement=n;var o=function(a){function b(){a.call(this),this.text=[],this.xs=[],this.textMeas=[],this.partials={},this.textClass="annotation-text",this.maxHeight=0,this.w=0,this.len=0,this.partials[0]=0}return __extends(b,a),b.prototype.add=function(a,b,c){for(var d=0;d<b.length;d++)this.partials[this.len+b[d]]=this.w+c[d].w;var e=c[c.length-1];this.xs.push(this.w),this.w+=e.w,this.maxHeight=Math.max(e.h,this.maxHeight),this.len+=a.length,this.text.push(a),this.textMeas.push(e)},b.prototype.section=function(a,b){return new e(this.x+this.partials[a],this.y,this.partials[b]-this.partials[a],this.maxHeight)},b.prototype.length=function(){return this.len},b.prototype.width=function(){return this.w},b.prototype.height=function(){return this.maxHeight},b.prototype.render=function(a){a.styleClass=this.textClass;for(var b=[],c=0;c<this.xs.length;c++)b.push(this.y+(this.maxHeight-this.textMeas[c].h)-this.textMeas[c].y);a.addTextSpanLine(this.renderLayer,this.text,this.xs,b),a.clearStyle()},b}(k);b.AnnoTextLine=o;var p=function(a){function b(b,c,d,e){a.call(this),this.curlyStyle="annotation-curly",this.stroke="",this.x=b||0,this.y=c||0,this.w=d||0,this.h=e||0}return __extends(b,a),b.prototype.width=function(){return this.w},b.prototype.height=function(){return this.h},b.prototype.render=function(a){a.styleClass=this.curlyStyle,a.stroke=this.stroke,a.addCurly(this.renderLayer,this.x,this.x+this.w/2,this.x+this.w,this.y,this.h),a.clearStyle()},b}(k);b.AnnoCurlyElement=p;var q=function(a){function b(b,c,d,e,f,g){a.call(this),this.rx=0,this.ry=0,this.fill="",this.stroke="",this.styleClass="",this.x=b||0,this.y=c||0,this.w=d||0,this.h=e||0,this.rx=f||0,this.ry=g||0}return __extends(b,a),b.prototype.render=function(a){a.fill=this.fill,a.stroke=this.stroke,a.styleClass=this.styleClass,a.addRect(this.renderLayer,this.x,this.y,this.w,this.h,this.rx,this.ry),a.clearStyle()},b.prototype.width=function(){return this.w},b.prototype.height=function(){return this.h},b}(k);b.AnnoRectElement=q;var r=function(a){function b(b,c,d){a.call(this),this.fill="",this.stroke="",this.styleClass="",this.points=[],this.x=b||0,this.y=c||0;for(var e=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,g=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,i=0;i<d.length;i+=2)e=Math.min(e,d[i]),f=Math.max(f,d[i]),g=Math.min(g,d[i+1]),h=Math.max(h,d[i+1]);if(this.w=f-e,this.h=h-g,0!==e||0!==f)for(var i=0;i<d.length/2;i+=2)d[i]-=e,d[i+1]-=g;this.points=d}return __extends(b,a),b.prototype.render=function(a){a.fill=this.fill,a.stroke=this.stroke,a.styleClass=this.styleClass,a.addPolygon(this.renderLayer,this.x,this.y,this.points),a.clearStyle()},b.prototype.width=function(){return this.w},b.prototype.height=function(){return this.h},b}(k);b.AnnoPolygon=r;var s=function(a){function b(b,c){a.call(this),this.elements=[],this.layerClasses={},this.w=void 0,this.h=void 0,this.isolateGroup=!1,this.x=b||0,this.y=c||0}return __extends(b,a),b.prototype.moveContent=function(a,b){if(0!==a||0!==b)for(var c=0,d=this.elements;c<d.length;c++){var e=d[c];e.x+=a,e.y+=b}},b.prototype.applyTransformation=function(){0===this.y&&0===this.x||(this.moveContent(this.x,this.y),this.x=0,this.y=0)},b.prototype.add=function(a){this.elements.push(a),this.w=void 0,this.h=void 0},b.prototype.width=function(){if(void 0===this.w){for(var a=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY,c=0,d=this.elements;c<d.length;c++){var e=d[c];b=Math.max(e.x+e.width(),b),a=Math.min(e.x,a)}this.w=b-a}return this.w},b.prototype.height=function(){if(void 0===this.h){for(var a=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY,c=0,d=this.elements;c<d.length;c++){var e=d[c];b=Math.max(e.y+e.height(),b),a=Math.min(e.y,a)}this.h=b-a}return this.h},b.prototype.bounds=function(){for(var a=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,f=0,g=this.elements;f<g.length;f++){var h=g[f];d=Math.max(h.x+h.width(),d),c=Math.min(h.x,c),b=Math.max(h.y+h.height(),b),a=Math.min(h.y,a)}return new e(c,a,d-c,b-a)},b.prototype.compact=function(){var a=this.bounds();if(0!==a.x||0!==a.y)for(var b=0,c=this.elements;b<c.length;b++){var d=c[b];d.x-=a.x,d.y-=a.y}},b.prototype.render=function(a){0===this.x&&0===this.y||(this.isolateGroup===!0?a.push(this.x,this.y):a.pushTranslation(this.x,this.y));for(var b=0,c=this.elements;b<c.length;b++){var d=c[b];d.render(a)}0===this.x&&0===this.y||(this.isolateGroup===!0?a.pop():a.popTranslation())},b}(k);b.AnnoGroup=s}),define("annotations/flowdocument",["require","exports","annotations/util","annotations/componentmodel"],function(a,b,c,d){"use strict";var h,e=function(){function a(){this.layer="",this.id="",this.label="",this.popup="",this.popupId="",this.color=null,this.strokeColor=null,this.bbox=null}return a}(),f=function(a){function b(){a.apply(this,arguments),this.startpos=0,this.endpos=0}return __extends(b,a),b}(e),g=function(a){function b(){a.apply(this,arguments),this.head="",this.tail="",this.startline=0,this.endline=0}return __extends(b,a),b}(e);!function(a){a.nodeLayerPriority={"node/Token":-2,"node/Sentence":Number.POSITIVE_INFINITY}}(h||(h={}));var i=function(){function a(a,b){this.bottomY=0,this.leftAttachmentPt={x:0,y:0},this.rightAttachmentPt={x:0,y:0},this.arrowLeft=!1,this.arrowRight=!1,this.leftHasNode=!1,this.rightHasNode=!1,this.parent=a,this.label=b,this.textElement=new d.AnnoTextElement(0,0,b.label,b.bbox,"annotation-label")}return a.prototype.closestPtByX=function(a,b){for(var c=b[0],d=Math.abs(a.x-b[0].x),e=1;e<b.length;e++)Math.abs(a.x-b[e].x)<d&&(d=Math.abs(a.x-b[e].x),c=b[e]);return c},a.prototype.optimizeLeft=function(a){this.leftAttachmentPt=this.closestPtByX(this.leftAttachmentPt,a)},a.prototype.optimizeRight=function(a){this.rightAttachmentPt=this.closestPtByX(this.rightAttachmentPt,a)},a.prototype.centerX=function(){var a=this.textElement.width()/2;return a+=this.parent.parent.doc.style.labelPadding,a+=this.parent.parent.doc.style.minEdgeLineLength,a+=this.parent.parent.doc.style.edgeBendDistance,Math.max(a,this.leftAttachmentPt.x+(this.rightAttachmentPt.x-this.leftAttachmentPt.x)/2)},a.prototype.width=function(){return this.rightX()-this.leftX()},a.prototype.leftX=function(){var a=this.centerX();return a-=this.textElement.width()/2,a-=this.parent.parent.doc.style.labelPadding,a-=this.parent.parent.doc.style.minEdgeLineLength,a-=this.parent.parent.doc.style.edgeBendDistance,Math.min(a,this.leftAttachmentPt.x)},a.prototype.rightX=function(){var a=this.centerX();return a+=this.textElement.width()/2,a+=this.parent.parent.doc.style.labelPadding,a+=this.parent.parent.doc.style.minEdgeLineLength,a+=this.parent.parent.doc.style.edgeBendDistance,Math.max(a,this.rightAttachmentPt.x)},a.prototype.height=function(){return this.textElement.height()},a.prototype.compile=function(a,b){var c=new d.AnnoGroup;this.textElement.renderLayer=d.RenderLayer.LABEL,this.textElement.data={"popup-title":this.label.tail+" → "+this.label.head+" : "+this.label.id,"popup-html":this.label.popup};Math.max(this.centerX(),this.textElement.width()/2+a+b);this.textElement.attach({x:this.centerX(),y:this.bottomY},d.AnchorPoint.BOTTOM_CENTER);var f=this.textElement.anchor(d.AnchorPoint.LEFT_CENTER),g=this.textElement.anchor(d.AnchorPoint.RIGHT_CENTER);f.x-=a,g.x+=a;var h=this.leftX()+b,i=new d.AnnoLineElement(h,f.y,f.x-h,0),j=new d.AnnoLineElement(g.x,g.y,this.rightX()-g.x-b,0);if(i.renderLayer=d.RenderLayer.EDGE_BACKGROUND,j.renderLayer=d.RenderLayer.EDGE_BACKGROUND,i.styleClass="annotation-edge-line",j.styleClass="annotation-edge-line",i.strokeWidth=void 0,j.strokeWidth=void 0,c.add(this.textElement),c.add(i),c.add(j),this.leftHasNode===!0){var k=new d.AnnoEdgeLineElement(i.x,i.y,i.x-b,i.y,this.leftAttachmentPt.x,this.leftAttachmentPt.y);k.arrow=this.arrowLeft===!0?"end":"",k.renderLayer=d.RenderLayer.EDGE_BACKGROUND,k.styleClass="annotation-edge-line",c.add(k)}else{this.leftAttachmentPt.y=i.y;var k=new d.AnnoEdgeLineElement(i.x,i.y,i.x,i.y,this.leftAttachmentPt.x,this.leftAttachmentPt.y);k.arrow=this.arrowLeft===!0?"end":"",k.renderLayer=d.RenderLayer.EDGE_BACKGROUND,k.styleClass="annotation-edge-line",c.add(k)}if(this.rightHasNode===!0){var l=j.anchor(d.AnchorPoint.RIGHT_CENTER),k=new d.AnnoEdgeLineElement(l.x,l.y,l.x+b,j.y,this.rightAttachmentPt.x,this.rightAttachmentPt.y);k.arrow=this.arrowRight===!0?"end":"",k.renderLayer=d.RenderLayer.EDGE_BACKGROUND,k.styleClass="annotation-edge-line",c.add(k)}else{this.rightAttachmentPt.y=j.y;var k=new d.AnnoEdgeLineElement(j.x,j.y,j.x,j.y,this.rightAttachmentPt.x,this.rightAttachmentPt.y);k.arrow=this.arrowRight===!0?"end":"",k.renderLayer=d.RenderLayer.EDGE_BACKGROUND,k.styleClass="annotation-edge-line",c.add(k)}return c},a}(),j=function(){function a(a){this.blocks=[],this.nodeLabels=[],this.edgeLabels=[],this.nodeId2idx={},this.height=0,this.masterBlock=new d.AnnoGroup,this.parent=a}return a.prototype.start=function(){return this.blocks[0].startpos},a.prototype.end=function(){return this.blocks[this.blocks.length-1].endpos},a.prototype.textExcerpt=function(a){var b=this.parent.doc.text.substring(a.startpos,a.endpos);return b=a.endpos-a.startpos>40?'"'+b.substring(0,40)+'"...':'"'+b+'"'},a.prototype.processExtensionMarkers=function(a,b,e){var f=a.startpos<this.start(),g=a.endpos>this.end();if(f||g){var h=this.parent.doc.style.triangleMargin;e.bounds();if(f){var j=c.Util.leftTriangle(.5*e.height(),.75*e.height()),k=new d.AnnoPolygon(0,0,j);k.renderLayer=d.RenderLayer.BACKGROUND,k.fill=b.stroke,k.attach(b.anchor(d.AnchorPoint.LEFT_CENTER),d.AnchorPoint.RIGHT_CENTER),k.x-=h,e.add(k)}if(g){var j=c.Util.rightTriangle(.5*e.height(),.75*e.height()),k=new d.AnnoPolygon(0,0,j);k.renderLayer=d.RenderLayer.BACKGROUND,k.fill=b.stroke,k.attach(b.anchor(d.AnchorPoint.RIGHT_CENTER),d.AnchorPoint.LEFT_CENTER),k.x+=h,e.add(k)}}},a.prototype.processNodeLabelBackground=function(a,b,e){var f=new d.AnnoRectElement(-b,-b,e.width()+2*b,e.height()+2*b,2,1);return f.stroke=c.Util.rgb2hex(c.Util.hsl2rgb(a.strokeColor)),f.fill=c.Util.rgb2hex(c.Util.hsl2rgb(a.color)),f.renderLayer=d.RenderLayer.BACKGROUND,e.add(f),f},a.prototype.processCurlyAttachment=function(a,b,e,f){var g=new d.AnnoCurlyElement(0,0,b.w,e);return g.renderLayer=d.RenderLayer.LABEL,g.stroke=c.Util.rgb2hex(c.Util.hsl2rgb(a.strokeColor)),g.attach(b.anchor(d.AnchorPoint.TOP_LEFT),d.AnchorPoint.BOTTOM_LEFT),f.add(g),g},a.prototype.lineBBox=function(a,b,c){var d=Math.max(this.start(),b)-this.start(),e=Math.min(this.end(),c)-this.start();return a.section(d,e)},a.prototype.resolveLabelPositioning=function(a,b){for(var c=0,d=Object.keys(a);c<d.length;c++){var e=d[c];a[e].sort(function(a,c){return b[a].x-b[c].x})}var f=[],g=this.parent.doc.style.labelMargin,i=[-g],j=Object.keys(a);j.sort(function(a,b){return(h.nodeLayerPriority[a]||0)-(h.nodeLayerPriority[b]||0)});for(var k=0,l=j;k<l.length;k++){for(var e=l[k],m=0,n=a[e];m<n.length;m++){for(var o=n[m],q=(this.nodeLabels[o],!1),r=0;r<i.length;r++)if(b[o].x>=i[r]+g){i[r]=b[o].x+b[o].width(),f[o]=r,q=!0;break}q===!1&&(f[o]=i.length,i.push(b[o].x+b[o].width()))}for(var r=0;r<i.length;r++)i[r]=Number.POSITIVE_INFINITY}return{layer:f,numLayers:i.length,priority:j}},a.prototype.computeNodeLayerInfo=function(a,b,c){for(var d=[],e=[],f=0;f<c;f++)d.push(0);for(var f=0;f<this.nodeLabels.length;f++)d[b[f]]=Math.max(d[b[f]],a[f].height());for(var g=0,h=0,f=0;f<c;f++)e.push(h),h-=d[f],g+=d[f];return e.push(g),{heights:d,offsets:e,totalHeight:g}},a.prototype.placeLabels=function(a){for(var b=[],c=[],e=this.parent.doc.style.curlyHeight,f=this.parent.doc.style.labelPadding,g={},h=0,i=this.nodeLabels;h<i.length;h++){var j=i[h],k=this.lineBBox(a,j.startpos,j.endpos),l=new d.AnnoGroup,m=new d.AnnoGroup,n=new d.AnnoTextElement(0,0,j.label,j.bbox,"annotation-label");n.data={"popup-title":this.textExcerpt(j)+" : "+j.id,"popup-html":j.popup},n.renderLayer=d.RenderLayer.LABEL,m.add(n);var o=this.processNodeLabelBackground(j,f,m);this.processExtensionMarkers(j,o,m),m.compact(),l.add(m);var p=this.processCurlyAttachment(j,k,e,l);m.attach(p.anchor(d.AnchorPoint.TOP_CENTER),d.AnchorPoint.BOTTOM_CENTER),m.x=Math.max(0,m.x);var q=g[j.layer];void 0===q&&(q=[],g[j.layer]=q),q.push(c.length),c.push(m),b.push(l)}for(var r=this.resolveLabelPositioning(g,c),s=this.computeNodeLayerInfo(b,r.layer,r.numLayers),t=0;t<this.nodeLabels.length;t++){var u=s.offsets[r.layer[t]];b[t].y+=u,b[t].applyTransformation(),this.masterBlock.add(b[t])}return{annotationBoxes:b,labelBoxes:c,binding:r,info:s,layer2labels:g}},a.prototype.placeLabelBackgrounds=function(a,b){for(var f=(b.info.totalHeight,0),g=b.binding.priority.reverse();f<g.length;f++)for(var h=g[f],i=0,j=b.layer2labels[h];i<j.length;i++){var k=j[i],l=this.nodeLabels[k],m=Math.max(this.start(),l.startpos)-this.start(),n=Math.min(this.end(),l.endpos)-this.start(),o=a.section(m,n),p=new d.AnnoRectElement(o.x,o.y,o.w,o.h,3,2);p.renderLayer=d.RenderLayer.BACKGROUND,p.styleClass="annotation-background",p.fill=c.Util.rgb2hex(c.Util.hsl2rgb(this.nodeLabels[k].color)),this.masterBlock.add(p)}},a.prototype.createTextLine=function(){var a=new d.AnnoTextLine;a.textClass="annotation-text";for(var b=0,c=this.blocks;b<c.length;b++){var e=c[b];a.add(e.text,e.lengths,e.measurements)}return a},a.prototype.closestPtByX=function(a,b){for(var c=b[0],d=Math.abs(a.x-b[0].x),e=1;e<b.length;e++)Math.abs(a.x-b[e].x)<d&&(d=Math.abs(a.x-b[e].x),c=b[e]);return c},a.prototype.middlePoint=function(a,b){var c=Math.min(a.x,b.x),d=Math.max(a.x,b.x),e=Math.min(a.y,b.y),f=Math.max(a.y,b.y);return{x:c+(d-c)/2,y:e+(f-e)/2}},a.prototype.possiblePointsAtNode=function(a){var b=a.anchor(d.AnchorPoint.TOP_CENTER);return[this.middlePoint(a.anchor(d.AnchorPoint.TOP_LEFT),b),b,this.middlePoint(a.anchor(d.AnchorPoint.TOP_RIGHT),b)]},a.prototype.placeEdges=function(a){for(var b=-a.info.totalHeight,c=[],e=0,f=this.edgeLabels;e<f.length;e++){var g=f[e],h=this.nodeId2idx[g.head],j=this.nodeId2idx[g.tail];if(void 0!==h&&void 0!==j){var k=a.labelBoxes[j],l=a.labelBoxes[h],m=new i(this,g),n=k.anchor(d.AnchorPoint.TOP_CENTER),o=l.anchor(d.AnchorPoint.TOP_CENTER);m.leftAttachmentPt=o.x<n.x?o:n,m.rightAttachmentPt=o.x<n.x?n:o,m.leftHasNode=!0,m.rightHasNode=!0,m.arrowLeft=o.x<n.x,m.arrowRight=!m.arrowLeft,m.optimizeLeft(this.possiblePointsAtNode(o.x<n.x?l:k)),m.optimizeRight(this.possiblePointsAtNode(o.x<n.x?k:l)),c.push(m)}else if(void 0===h&&void 0===j){var m=new i(this,g);m.leftAttachmentPt={x:0,y:0},m.rightAttachmentPt={x:this.parent.width,y:0},m.leftHasNode=!1,m.rightHasNode=!1,m.arrowLeft=g.startline<this.linenb,m.arrowRight=!m.arrowLeft,c.push(m)}else{var m=new i(this,g),p=void 0===h?j:h,q=a.labelBoxes[p],r=q.anchor(d.AnchorPoint.TOP_CENTER);g.startline<this.linenb?(m.leftAttachmentPt={x:0,y:0},m.rightAttachmentPt=r,m.leftHasNode=!1,m.rightHasNode=!0,m.optimizeRight(this.possiblePointsAtNode(q)),m.arrowLeft=void 0===h,m.arrowRight=!m.arrowLeft):(m.leftHasNode=!0,m.rightHasNode=!1,m.leftAttachmentPt=r,m.rightAttachmentPt={x:this.parent.width,y:0},m.optimizeLeft(this.possiblePointsAtNode(q)),m.arrowLeft=void 0!==h,m.arrowRight=!m.arrowLeft),c.push(m)}}for(var s=this.resolveEdgePositioning(c,b),t=0;t<c.length;t++)this.masterBlock.add(c[t].compile(this.parent.doc.style.labelPadding,this.parent.doc.style.edgeBendDistance));return Math.max(0,s)},a.prototype.resolveEdgePositioning=function(a,b){for(var d=[],e=Number.NEGATIVE_INFINITY,f=0;f<a.length;f++)null!==a[f]&&(d.push(f),e=Math.max(e,a[f].rightX()));var h,g={};h=[new c.Util.SparseGridSpatialIndex(0,e,Math.max(1,Math.floor(e/25)))],d.sort(function(b,c){return a[b].width()-a[c].width()});for(var f=0;f<d.length;f++){for(var j=(this.edgeLabels[d[f]],!1),k=a[d[f]],l=k.leftX(),m=k.rightX(),n=0;n<h.length;n++)if(h[n].anyIntersection(l,m)===!1){g[d[f]]=n,j=!0,h[n].add(l,m,d[f]);break}j===!1&&(h.push(new c.Util.SparseGridSpatialIndex(0,m,Math.max(1,Math.floor(m/25)))),h[h.length-1].add(l,m,d[f]),g[d[f]]=h.length-1)}for(var o=[],f=0;f<h.length;f++)o.push(Number.NEGATIVE_INFINITY);for(var f=0;f<d.length;f++){var p=g[d[f]];o[p]=Math.max(o[p],a[d[f]].height())}for(var q=[],r=this.parent.doc.style.edgeLayerMargin,s=b-this.parent.doc.style.edgeLayerMargin,f=0;f<h.length;f++)q.push(s),
s-=o[f],r+=o[f];for(var f=0;f<d.length;f++)a[d[f]].bottomY=q[g[d[f]]];return r},a.prototype.layout=function(a){var b=this.createTextLine(),c=this.placeLabels(b),d=this.placeEdges(c);this.placeLabelBackgrounds(b,c),this.masterBlock.y=d+c.info.totalHeight,this.height=b.height()+d+c.info.totalHeight,this.masterBlock.add(b),this.masterBlock.applyTransformation()},a.prototype.render=function(a){this.masterBlock.render(a)},a}(),k=function(){function a(a){this.height=0,this.blocks=[],this.lines=[],this.lineOffsetY=[],this.doc=a}return a.prototype.layout=function(){this.lineOffsetY=[],this.height=this.doc.style.lineRowPadding;for(var a=0,b=this.lines;a<b.length;a++){var c=b[a];this.lineOffsetY.push(this.height),c.layout(this.doc.style),this.height+=this.doc.style.lineRowPadding+c.height}},a.prototype.render=function(a){for(var b=0;b<this.lines.length;b++)a.push(0,this.lineOffsetY[b]),this.lines[b].render(a),a.pop();if(this.doc.showSegmentMargin===!0){var c=-this.doc.segmentMarginWidth-this.doc.style.segmentInnerPadding;c+=this.doc.segmentMarginWidth-this.marginMeas.w-this.doc.style.segmentMarginPaddingRight,a.styleClass="annotation-margin",a.addText(d.RenderLayer.TEXT,this.marginText,c,this.lineOffsetY[0]+this.lines[0].height-(this.marginMeas.h+this.marginMeas.y))}},a}(),l=function(){function a(a,b){this.layers={},this.segments=[],this.nodeLabels=[],this.edgeLabels=[],this.uniqueCoordinates=[],this.showSegmentMargin=!0,this.segmentStart=void 0,this.segmentEnd=void 0,this.segStart=0,this.segEnd=0,this.boundLabels={},this.style={lineRowPadding:10,segmentRowPadding:0,segmentMarginPaddingLeft:5,segmentMarginPaddingRight:2,segmentInnerPadding:10,showSegmentMarginLine:!0,curlyHeight:5,labelMargin:2,labelPadding:2,triangleMargin:0,minEdgeLineLength:5,edgeBendDistance:10,edgeLayerMargin:10},this.setTarget(a);for(var c=0,d=Object.keys(b.nodeLayers);c<d.length;c++){var e=d[c];this.layers[e]=!0}this.segment(b),this.measureAll(b),this.colorizeLabels()}return a.prototype.setTarget=function(a){this.parentElem=a,this.renderElem=document.createElementNS(d.Svg.NS,"svg"),this.parentElem.appendChild(this.renderElem)},a.prototype.setLayers=function(a){this.layers={};for(var b=0,c=a;b<c.length;b++){var d=c[b];this.layers[d]=!0}},a.prototype.partials=function(a){for(var b=[],c=0,d=a.nodeLayers;c<d.length;c++)for(var e=d[c],f=0,g=e.ranges;f<g.length;f++){var h=g[f];b.push(h)}b.push(0),b.push(a.text.length),b.sort(function(a,b){return a-b});for(var i=[],j=-1,k=0,l=b;k<l.length;k++){var h=l[k];j!==h&&(i.push(h),j=h)}return i},a.prototype.segment=function(a){this.text=a.text.replace(/\s/g," ");var b=/\s+/g,c=this.partials(a),d=0;this.uniqueCoordinates=c;for(var e=0;e<a.segments.length;e+=2){var f=new k(this);f.startpos=a.segments[e],f.endpos=a.segments[e+1],f.text=a.text.substring(f.startpos,f.endpos),f.marginText=(e/2+1).toString(10);for(var g=void 0,h=0;null!==(g=b.exec(f.text));){var i=h+f.startpos,j=g.index+g.length+f.startpos;f.blocks.push({startpos:i,endpos:j,text:this.text.substring(i,j),measurements:[],lengths:[]}),h=g.index+g.length,g.index===b.lastIndex&&b.lastIndex++}h!==f.text.length&&f.blocks.push({startpos:h+f.startpos,endpos:f.text.length+f.startpos,text:this.text.substring(h+f.startpos,f.startpos+f.text.length),measurements:[],lengths:[]});for(var l=0;d<c.length&&l<f.blocks.length;)if(c[d]<=f.blocks[l].startpos)d++;else if(c[d]>f.blocks[l].endpos)l++;else{var m=c[d]-f.blocks[l].startpos;f.blocks[l].lengths.push(m),d++}for(var n=0,o=f.blocks;n<o.length;n++){var p=o[n];p.lengths.length>0&&p.lengths[p.lengths.length-1]!==p.endpos-p.startpos?p.lengths.push(p.endpos-p.startpos):0===p.lengths.length&&p.lengths.push(p.endpos-p.startpos)}this.segments.push(f)}},a.prototype.measureAll=function(a){for(var b=[],c=[],e=0,h=this.segments;e<h.length;e++){for(var i=h[e],j=0,k=i.blocks;j<k.length;j++)for(var l=k[j],m=0,n=l.lengths;m<n.length;m++){var o=n[m];b.push(this.text.substring(l.startpos,l.startpos+o)),c.push("annotation-text")}b.push(i.marginText),c.push("annotation-margin")}for(var p=0,q=a.nodeLayers;p<q.length;p++){for(var r=q[p],s=0,t=Object.keys(r.labels);s<t.length;s++){var u=t[s];b.push(r.labels[u]),c.push("annotation-label")}b.push(r.name),c.push("annotation-label")}for(var v=0,w=a.edgeLayers;v<w.length;v++){for(var r=w[v],x=0,y=Object.keys(r.labels);x<y.length;x++){var u=y[x];b.push(r.labels[u]),c.push("annotation-label")}b.push(r.name),c.push("annotation-label")}for(var z=d.Svg.measureTexts(this.renderElem,b,c),A=z["annotation-text"],B=0,C=this.segments;B<C.length;B++){for(var i=C[B],D=0,E=i.blocks;D<E.length;D++)for(var l=E[D],F=0,G=l.lengths;F<G.length;F++){var o=G[F];l.measurements.push(A[this.text.substring(l.startpos,l.startpos+o)])}i.marginMeas=z["annotation-margin"][i.marginText]}for(var H=0,I=a.nodeLayers;H<I.length;H++)for(var r=I[H],J=0;J<r.ranges.length/2;J++){var K=new f;K.id=r.id[J],K.layer="node/"+r.name,K.label=r.labels[K.id],void 0===K.label&&(K.label=r.name),K.startpos=r.ranges[2*J],K.endpos=r.ranges[2*J+1],K.bbox=z["annotation-label"][K.label],K.popup=r.popups[K.id],this.nodeLabels.push(K)}for(var L=0,M=a.edgeLayers;L<M.length;L++)for(var r=M[L],J=0;J<r.id.length;J++){var K=new g;K.id=r.id[J],K.layer="edge/"+r.name,K.label=r.labels[K.id],void 0===K.label&&(K.label=r.name),K.head=r.head[J],K.tail=r.tail[J],K.bbox=z["annotation-label"][K.label],K.popup=r.popups[K.id],this.edgeLabels.push(K)}},a.prototype.colorizeLabels=function(){for(var a={},b=0,d=this.nodeLabels;b<d.length;b++){var e=d[b];a[e.label]=!0}for(var f=0,g=this.edgeLabels;f<g.length;f++){var e=g[f];a[e.label]=!0}for(var h=c.Util.generatePastelColors(Object.keys(a).length),i=[],j=c.Util.hsl(1,.75,.5),k=0,l=h;k<l.length;k++){var m=l[k];i.push(c.Util.mulHsl(m,j))}for(var n={},o={},p=0,q=0,r=Object.keys(a);q<r.length;q++){var s=r[q];n[s]=h[p],o[s]=i[p],p+=1}for(var t=0,u=this.nodeLabels;t<u.length;t++){var e=u[t];e.color=n[e.label],e.strokeColor=o[e.label]}for(var v=0,w=this.edgeLabels;v<w.length;v++){var e=w[v];e.color=n[e.label],e.strokeColor=o[e.label]}},a.prototype.lineflow=function(){var a=this.maxWidth,b=0;if(this.showSegmentMargin===!0){for(var c=0,d=this.segments;c<d.length;c++){var e=d[c];b=Math.max(b,e.marginMeas.w)}b+=this.style.segmentMarginPaddingLeft+this.style.segmentMarginPaddingRight}this.segmentMarginWidth=b,a-=b+2*this.style.segmentInnerPadding;for(var f=a,g=0,h=0;h<this.segments.length;h++){for(var e=this.segments[h],i=0,k=e.lines;i<k.length;i++){var l=k[i];l.parent=void 0}e.width=a,e.lines=[];for(var m=new j(e),n=0,o=0;o<e.blocks.length;o++){var p=e.blocks[o],q=p.measurements[p.measurements.length-1],r=q.w-q.x;0===m.blocks.length?(m.blocks.push(p),n+=r):n+r>a?(e.lines.push(m),m.linenb=g,g+=1,m=new j(e),n=0,m.blocks.push(p),n+=r):(m.blocks.push(p),n+=r),f=Math.max(f,n)}0!==m.blocks.length&&(e.lines.push(m),m.linenb=g,g+=1)}this.actualMaxWidth=Math.max(this.maxWidth,f+b+2*this.style.segmentInnerPadding)},a.prototype.assignLabels=function(){for(var a=0,b=0,c=[],d=0,e=this.segments;d<e.length;d++)for(var f=e[d],g=0,h=f.lines;g<h.length;g++){var i=h[g];c.push(i)}for(var j={};a<c.length&&b<this.uniqueCoordinates.length;)c[a].start()>this.uniqueCoordinates[b]?(b++,console.log("Should not have happend!")):this.uniqueCoordinates[b]>c[a].end()?a++:(j[this.uniqueCoordinates[b]]=a,b++);for(var k={},l=0,m=this.nodeLabels;l<m.length;l++){var n=m[l];if(this.layers[n.layer]===!0){var o=j[n.startpos],p=j[n.endpos];k[n.id]=[o,p+1];for(var q=o;q<=p;q++)c[q].start()<n.endpos&&c[q].end()>n.startpos&&(c[q].nodeId2idx[n.id]=c[q].nodeLabels.length,c[q].nodeLabels.push(n))}}for(var r=0,s=this.edgeLabels;r<s.length;r++){var n=s[r];if(this.layers[n.layer]===!0){var t=k[n.head],u=k[n.tail];if(void 0!==t&&void 0!==u){for(var o=Math.min(t[0],u[0]),p=Math.max(t[1],u[1]),v=c.length+1,w=-1,q=o;q<p;q++)void 0===c[q].nodeId2idx[n.head]&&void 0===c[q].nodeId2idx[n.tail]||(v=Math.min(v,q),w=Math.max(w,q));w+=1,n.startline=v,n.endline=w+1;for(var q=v;q<w;q++)c[q].edgeLabels.push(n)}}}},a.prototype.remove=function(){for(var a=0,b=Object.keys(this.boundLabels);a<b.length;a++){var c=b[a];$(this.boundLabels[c]).empty()}this.boundLabels={},this.renderElem.innerHTML=null},a.prototype.update=function(){this.remove(),this.segStart=this.segmentStart||0,this.segEnd=Math.min(this.segmentEnd||this.segments.length,this.segments.length),this.maxWidth=parseFloat(window.getComputedStyle(this.parentElem,null).width),this.lineflow(),this.assignLabels();for(var a=[],b=this.style.segmentRowPadding,c=this.segStart;c<this.segEnd;c++){var e=this.segments[c];e.layout(),a.push(b),b+=e.height+this.style.segmentRowPadding}this.height=b,$(this.renderElem).detach(),this.renderElem.setAttribute("style","width:"+this.actualMaxWidth+"px; height:"+this.height+"px;"),this.renderElem.setAttribute("version","1.2"),this.renderElem.setAttribute("class","annotation-box"),this.renderElem.innerHTML='<defs><marker id="arrow" markerWidth="10" markerHeight="10" refx="9" refy="3" orient="auto" markerUnits="userSpaceOnUse">'+"<path d='M0,0 Q 3,3 0,6 L9,3 z' fill='#000' /></marker></defs>";for(var f=new d.AnnoGraphics(this.renderElem),c=this.segStart;c<this.segEnd;c++){var e=this.segments[c];f.layerClasses[d.RenderLayer.LABEL]="annotation-segment",f.push(this.segmentMarginWidth+this.style.segmentInnerPadding,a[c],"seg"+c),e.render(f),f.pop()}this.showSegmentMargin===!0&&(f.clearStyle(),f.styleClass="annotation-margin-line",f.addLine(d.RenderLayer.BACKGROUND,this.segmentMarginWidth,0,this.segmentMarginWidth,this.height)),f.write(),this.boundLabels={};var g=this;$(this.renderElem).find(".annotation-label").each(function(a,b){$(b).on("mouseenter",function(c){void 0===g.boundLabels[a]&&(g.boundLabels[a]=b,$(this).qtip({content:{attr:"data-popup-html",title:{text:function(a,b){return $(this).attr("data-popup-title")},button:!0}},show:{delay:100,ready:!0},hide:{fixed:!0,delay:300},events:{show:function(a,b){$(b.elements.titlebar).on("click",function(a){b.get("hide.event")!==!1&&($(this).find(".qtip-title").prepend($('<i class="pin icon"></i>')),b.set("hide.event",!1))}),$(this).draggable({containment:"window",handle:b.elements.titlebar,drag:function(a,c){b.get("hide.event")!==!1&&($(this).find(".qtip-title").prepend($('<i class="pin icon"></i>')),b.set("hide.event",!1))}})},hide:function(a,b){b.set("hide.event","mouseleave")},hidden:function(a,b){$(this).find(".icon").remove()}},position:{my:"bottom center",at:"top center",viewport:$(window)},style:{classes:"qtip-rounded qtip-light qtip-shadow"}}))})}),$(this.parentElem).append(this.renderElem)},a}();b.FlowDocument=l}),define("constants",["require","exports"],function(a,b){"use strict";var c=13;b.ENTER_KEY=c;var d=27;b.ESCAPE_KEY=d}),define("AnnotationView",["require","exports","react","react-dom","annotations/flowdocument"],function(a,b,c,d,e){"use strict";var f=function(a){function b(b){var c=this;a.call(this,b),this.docChanged=!0,this.showMoreListener=function(a){return c.showMore()},this.showAllListener=function(a){return c.showAllToggle()},this.lastActiveTimeout=void 0,this.windowResizerEventHandler=function(){c.windowResized()},this.state={ready:!1,maxSegments:10}}return __extends(b,a),b.prototype.componentWillUnmount=function(){void 0!==this.doc&&(this.doc.remove(),this.renderElem.innerHTML=""),this.renderElem=void 0,window.removeEventListener("resize",this.windowResizerEventHandler);var a=d.findDOMNode(this.refs["show-more"]);a.removeEventListener("click",this.showMoreListener)},b.prototype.componentWillReceiveProps=function(a){void 0!==a.doc&&this.props.doc!==a.doc?(this.docChanged=!0,this.setState({doc:this.convert(a.doc)})):void 0===a.doc&&(this.docChanged=!0,this.setState({doc:void 0}))},b.prototype.componentDidUpdate=function(){var a=this;if(void 0===this.state.doc&&void 0!==this.props.doc&&this.setState({doc:this.convert(this.props.doc)}),void 0===this.state.doc&&void 0!==this.doc&&(this.doc.remove(),this.doc=void 0,this.renderElem.innerHTML=""),void 0!==this.state.doc){var b=document.createElement("div");b.setAttribute("class","ui small text loader"),b.innerText="Rendering...",void 0!==this.doc&&(this.doc.remove(),this.renderElem.innerHTML=""),this.renderElem.appendChild(b),b.style.display="none",b.style.display="block",this.renderElem.style.minHeight="200px",this.docChanged===!0&&(this.doc=new e.FlowDocument(this.renderElem,this.state.doc),this.doc.showSegmentMargin=!1,this.docChanged=!1,this.doc.segmentStart=0),(this.props.showAllSegments||!1)===!0?this.doc.segmentEnd=this.doc.segments.length:this.doc.segmentEnd=this.state.maxSegments,setTimeout(function(){a.doc.setLayers(a.props.layers),a.doc.update(),a.renderElem.removeChild(b),a.renderElem.style.minHeight=void 0})}},b.prototype.formatPropertyValue=function(a){if(null===a)return"null";if(a.length>=4&&"urn:"===a.substring(0,4)){var b=/urn:wikidata:([QP][0-9]+)/,c=void 0;if(null!==(c=b.exec(a)))return'<a href="http://www.wikidata.org/wiki/'+c[1]+'">'+a+"</a>";var d=/urn:wikipedia:([a-z]+):(.+)/;if(null!==(c=d.exec(a)))return'<a href="http://'+c[1]+".wikipedia.org/wiki/"+encodeURIComponent(c[2])+'">'+he.encode(a)+"</a>"}return a.length>5&&"http://"===a.substring(0,7).toLowerCase()?'<a href="'+a+'">'+he.encode(a)+"</a>":a},b.prototype.formatProperties=function(a){var b=this,c=["<table class='prop-table'><thead><tr>"];return $.each(a,function(a,b){c.push("<th>"+he.encode(a)+"</th>")}),c.push("</tr></thead><tbody><tr>"),$.each(a,function(a,d){c.push("<td>"+b.formatPropertyValue(d)+"</td>")}),c.push("</tr></tbody></table>"),c.join("")},b.prototype.showAllToggle=function(){void 0!==this.state.doc&&(this.state.maxSegments<this.state.doc.segments.length/2?this.setState({maxSegments:this.state.doc.segments.length/2}):this.setState({maxSegments:10}))},b.prototype.abbreviateLayerName=function(a,b){for(var f,c=[],d=[],e=/([A-Z])/g;null!==(f=e.exec(a));)f.index===e.lastIndex&&e.lastIndex++,c.push(f[1]),d.push(f.index);var g=c.join("");return void 0===b[g]?g:(g=c.slice(0,c.length-1).join("")+a.substring(d[d.length-1]),void 0===b[g]?g:a)},b.prototype.convert=function(a){for(var b={text:a.text,nodeLayers:[],edgeLayers:[],segments:[]},c={},d={},e=0,f=Object.keys(a.nodelayers);e<f.length;e++){var g=f[e],h={name:g,id:[],ranges:[],labels:{},popups:{}},i=this.abbreviateLayerName(g,c);c[i]=!0;for(var j=0,k=a.nodelayers[g];j<k.length;j++){var l=k[j],m=i+l.id;h.id.push(m),h.ranges.push(l.start),h.ranges.push(l.end),h.labels[m]=l.label,h.popups[m]=this.formatProperties(l.properties),d[l.id]=m}b.nodeLayers.push(h)}for(var n=0,o=Object.keys(a.edgelayers);n<o.length;n++){var g=o[n],p={name:g,id:[],head:[],tail:[],labels:{},popups:{}},i=this.abbreviateLayerName(g,c);c[i]=!0;for(var q=0,r=a.edgelayers[g];q<r.length;q++){var s=r[q],m=i+s.id;p.id.push(m),p.head.push(d[s.head]),p.tail.push(d[s.tail]),p.labels[m]=s.label,p.popups[m]=this.formatProperties(s.properties)}b.edgeLayers.push(p)}for(var v,t=/\n/g,u=0;null!==(v=t.exec(a.text));)v.index===t.lastIndex&&t.lastIndex++,u!==v.index?(b.segments.push(u),b.segments.push(v.index)):(b.segments.push(v.index),b.segments.push(v.index+v.length)),u=v.index+v.length;return u!==a.text.length&&(b.segments.push(u),b.segments.push(a.text.length)),b},b.prototype.windowResized=function(){var a=this;void 0!==this.lastActiveTimeout&&window.clearTimeout(this.lastActiveTimeout),this.lastActiveTimeout=window.setTimeout(function(){a.forceUpdate(),a.lastActiveTimeout=void 0},300)},b.prototype.showMore=function(){this.setState({maxSegments:this.state.maxSegments+10})},b.prototype.componentDidMount=function(){this.renderElem=d.findDOMNode(this.refs["anno-component"]);var a=d.findDOMNode(this.refs["show-more"]),b=d.findDOMNode(this.refs["show-all"]);a.addEventListener("click",this.showMoreListener),b.addEventListener("click",this.showAllListener),window.addEventListener("resize",this.windowResizerEventHandler,!0),this.docChanged=!0,this.componentDidUpdate()},b.prototype.render=function(){var a=!1;void 0!==this.state.doc&&(this.props.showAllSegments||!1)===!1&&this.state.maxSegments<this.state.doc.segments.length/2&&(a=!0);var b=void 0!==this.state.doc&&(this.props.showAllSegments||!1)===!1&&this.state.doc.segments.length>20;return c.createElement("div",null,c.createElement("div",{ref:"anno-component"}),c.createElement("div",{className:"two ui buttons"},c.createElement("button",{ref:"show-more",className:"fluid ui button "+(b===!0&&a===!1?"disabled":""),style:{display:b||a===!0?"block":"none"}},c.createElement("i",{className:"angle double down icon"}),"Show more..."),c.createElement("button",{ref:"show-all",style:{display:b?"block":"none"},className:"fluid ui button"+(a===!1?" positive":"")},c.createElement("i",{className:"expand icon"}),"Show all")))},b}(c.Component);b.AnnotationView=f}),define("MultipleSelectDropdown",["require","exports","react","react-dom"],function(a,b,c,d){"use strict";var e=function(a){function b(b){a.call(this,b),this.deltaVersion=0,this.dropdownVisible=!1,this.state={selected:b.selected}}return __extends(b,a),b.prototype.propagate=function(){var a=this;window.setTimeout(function(){return a.props.onSelected(a.state.selected)},100)},b.prototype.componentWillReceiveProps=function(a){if(void 0!==a.selected){var b=d.findDOMNode(this.refs["annotation-layers"]),c=$(b);c.dropdown("set selected",a.selected)}},b.prototype.componentDidMount=function(){var a=this,b=d.findDOMNode(this.refs["annotation-layers"]),c=$(b);c.dropdown({allowAdditions:!0,onChange:function(b){a.state.selected=b,a.dropdownVisible===!1?a.propagate():a.deltaVersion+=1},onShow:function(b){a.dropdownVisible=!0},onHide:function(b){return a.dropdownVisible=!1,a.deltaVersion>0&&(a.propagate(),a.deltaVersion=0),!0}}),c.dropdown("set selected",this.props.selected)},b.prototype.render=function(){var a=[];return $.each(this.props.options,function(b,d){a.push(c.createElement("option",{key:b,value:b},d))}),c.createElement("select",{ref:"annotation-layers",multiple:"true",className:"ui fluid dropdown"},c.createElement("option",{key:"__DEFAULT__",value:""},this.props.text),a)},b}(c.Component);b.MultipleSelectDropdown=e}),define("DocumentView",["require","exports","react","MultipleSelectDropdown","AnnotationView"],function(a,b,c,d,e){"use strict";var f=function(a){function b(b){a.call(this,b),this.state={selectedLayers:[]}}return __extends(b,a),b.prototype.computeFragments=function(a){if(void 0===a.fragments)if(a.fragments={},a.fragmentlist=[],a.nodelayers.Paragraph)$.each(a.nodelayers.Paragraph,function(b,c){a.fragments[b]={start:c.start,end:c.end},a.fragmentlist.push(b)});else if(a.nodelayers.Sentence)$.each(a.nodelayers.Sentence,function(b,c){a.fragments[b]={start:c.start,end:c.end},a.fragmentlist.push(b)});else{var b=1,c=/((?:(?:.+)\n\s*)+\n\s*)|(.+)/g,d=void 0,e=0;for(a.text.indexOf("\n\n")>0&&(a.text+="\n\n");null!==(d=c.exec(a.text));)d.index===c.lastIndex&&c.lastIndex++,e!==d.index&&(a.fragments[b]={start:e,end:d.index},a.fragmentlist.push(b),b+=1,e=d.index);a.fragments[b]={start:e,end:a.text.length},a.fragmentlist.push(b),a.sentences=[];var f=/(\n\s*)/gm;for(e=0;null!==(d=f.exec(a.text));)e!==d.index&&(a.sentences.push(e),a.sentences.push(d.index),e=d.index+d[1].length);a.sentences.push(e),a.sentences.push(a.text.length)}},b.prototype.componentWillReceiveProps=function(a){void 0!==a.annodata&&this.computeFragments(a.annodata)},b.prototype.handleLayersChanged=function(a){this.setState({selectedLayers:a})},b.prototype.render=function(){if(this.props.annoview===!0){var a={};return this.props.annodata&&(Object.keys(this.props.annodata.nodelayers).forEach(function(b){a["node/"+b]=b+" (Nodes)"}),Object.keys(this.props.annodata.edgelayers).forEach(function(b){a["edge/"+b]=b+" (Edges)"})),c.createElement("div",null,c.createElement(d.MultipleSelectDropdown,{text:"Layers",onSelected:this.handleLayersChanged.bind(this),selected:this.state.selectedLayers,options:a}),c.createElement(e.AnnotationView,{layers:this.state.selectedLayers,doc:this.props.annodata}))}for(var b=[],f=/\n/g,g=0,h=void 0,i=0;h=f.exec(this.props.text);)b.push(c.createElement("span",{key:"e"+ ++i},this.props.text.substring(g,h.index))),b.push(c.createElement("br",{key:"e"+ ++i})),g=h.index+h.length;return g!==this.props.text.length?b.push(this.props.text.substring(g)):b.pop(),c.createElement("p",null,b)},b}(c.Component);b.DocumentView=f}),define("app",["require","exports","react","react-dom","DocumentView"],function(a,b,c,d,e){"use strict";var f=function(a){function b(b){a.call(this,b),this.wikiEditionFullName={en:"English",sv:"Swedish",ru:"Russian",es:"Spanish",de:"German",fr:"French"},this.state={annotating:!1,text:"",config:"en/default"}}return __extends(b,a),b.prototype.annotate_text=function(a){var b=this;this.setState({annotating:!0,doc:void 0}),$.ajax("./"+this.state.config+"/api/annoviz",{data:a,processData:!1,type:"POST",contentType:"text/plain; charset=utf-8"}).done(function(a){var c=a;b.setState({annotating:!1,doc:c})}).fail(function(a,c,d){b.setState({annotating:!1}),console.error(d)})},b.prototype.annotate_wikipedia=function(a,b){var c=this;this.setState({annotating:!0,doc:void 0});var d={async:!0,crossDomain:!0,url:"https://"+a+".wikipedia.org/api/rest_v1/page/html/"+encodeURIComponent(b),method:"GET"};$.ajax(d).done(function(a){$.ajax("./"+c.state.config+"/api/wikipedia/annoviz",{data:a,processData:!1,type:"POST",contentType:"text/html; charset=utf-8"}).done(function(a){var b=a;c.setState({annotating:!1,doc:b})}).fail(function(a,b,d){c.setState({annotating:!1}),console.error(d)})})},b.prototype.annotate_click=function(a){var b=$(".modeselector .active").attr("data-tab");if("text"===b){var c=d.findDOMNode(this.refs.textholder);void 0!==c.value&&c.value.length>0&&this.annotate_text(c.value)}else if("wikipedia"===b){var e=d.findDOMNode(this.refs["wikipedia-page"]);e.value.length>0&&this.annotate_wikipedia(this.state.config.substring(0,2),e.value)}},b.prototype.selectConfig=function(a,b){this.setState({config:a+"/"+b});var c=d.findDOMNode(this.refs["lang-select"]);$(c).dropdown("set selected","en/default")},b.prototype.bindSearch=function(a,b){$(a).search("destroy"),$(a).search({searchFields:["title"],minCharacters:3,showNoResults:!0,searchDelay:300,apiSettings:{dataType:"jsonp",onResponse:function(a){for(var b={results:[]},c=0,d=a.query.prefixsearch;c<d.length;c++){var e=d[c];b.results.push(e)}return b},url:"//"+b+".wikipedia.org/w/api.php?action=query&list=prefixsearch&format=json&pssearch={query}"}})},b.prototype.componentDidMount=function(){var a=this,b=this.setState;this.router=Router({"/":b.bind(this,{text:""}),"/:lang/:config/":function(b,c){return a.selectConfig(b,c)}}),this.router.init("/");var c=d.findDOMNode(this.refs["lang-select"]),e=d.findDOMNode(this.refs["wiki-search"]);$(c).dropdown({allowCategorySelection:!0,onChange:function(b,c,d){a.setState({config:b}),a.bindSearch(e,b.substring(0,2))}}),$(c).dropdown("set selected","en/default"),this.bindSearch(e,"en"),$(".modeselector .item").tab()},b.prototype.render=function(){for(var a=this,b=Object.keys(config_langs),d=[],f=0,g=b;f<g.length;f++){for(var h=g[f],i=[],j=0,k=config_langs[h];j<k.length;j++){var l=k[j];i.push(c.createElement("div",{className:"item","data-value":h+"/"+l,key:"c_"+h+"/"+l},config_friendly[h+"/"+l]))}d.push(c.createElement("div",{className:"item","data-value":h+"/default",key:"l_"+h},c.createElement("i",{className:"dropdown icon"}),c.createElement("span",{className:"text"},h),c.createElement("div",{className:"menu"},i)))}var m=this.wikiEditionFullName[(this.state.config||"en").substring(0,2)];return c.createElement("div",null,c.createElement("div",{className:"ui top attached tabular menu modeselector"},c.createElement("a",{className:"active item","data-tab":"text"},"Text"),c.createElement("a",{className:"item","data-tab":"wikipedia"},"Wikipedia")),c.createElement("div",{className:"ui bottom attached active tab segment modeselector","data-tab":"text"},c.createElement("div",{className:"ui form"},c.createElement("div",{className:"field"},c.createElement("textarea",{ref:"textholder"})))),c.createElement("div",{className:"ui bottom attached tab segment modeselector","data-tab":"wikipedia"},c.createElement("div",{className:"ui form"},c.createElement("div",{className:"field"},c.createElement("label",null,"Page Title (",m," Wikipedia)"),c.createElement("div",{className:"ui search",ref:"wiki-search"},c.createElement("div",{className:"ui icon input"},c.createElement("input",{className:"prompt",type:"text",ref:"wikipedia-page",placeholder:"Wikipedia page title..."}),c.createElement("i",{className:"search icon"})),c.createElement("div",{className:"results"}))))),c.createElement("div",{className:"ui form"},c.createElement("div",{className:"field"},c.createElement("div",{ref:"lang-select",className:"ui dropdown icon button"},c.createElement("i",{className:"world icon"}),c.createElement("span",{className:"text"},"Select Language"),c.createElement("div",{className:"menu"},d)),c.createElement("button",{onClick:function(b){return a.annotate_click(b)},className:(this.state.annotating===!0?"loading ":"")+"positive ui button"},"Annotate"))),c.createElement("div",{className:"ui segment"},c.createElement("div",{className:"ui "+(this.state.annotating?"active ":"")+"inverted dimmer"},c.createElement("div",{className:"ui large text loader"},"Annotating...")),c.createElement("div",{style:{minHeight:"150pt"}},c.createElement(e.DocumentView,{ref:"docview",annoview:void 0!==this.state.doc,annodata:this.state.doc,text:""}))))},b}(c.Component);$(window).ready(function(){d.render(c.createElement(f,null),document.getElementById("nlpapp"))})}),define("DocumentFragment",["require","exports","react","AnnotationView"],function(a,b,c,d){"use strict";var e=function(a){function b(b){a.call(this,b),this.state={display:!1}}return __extends(b,a),b.prototype.handleChange=function(a){var b=a.target;console.dir(b.checked),this.setState({display:b.checked})},b.prototype.render=function(){var a=this,b=null;return this.state.display===!0&&(b=c.createElement(d.AnnotationView,{doc:this.props.entry,layers:this.props.layers})),c.createElement("div",{className:"paragraph"},c.createElement("div",{className:"ui checkbox"},c.createElement("input",{type:"checkbox",className:"annotation-checkbox",onChange:function(b){return a.handleChange(b)}}),c.createElement("label",null,c.createElement("p",null,this.props.entry.text.substring(this.props.start,this.props.end)))),b)},b}(c.Component);b.DocumentFragment=e});